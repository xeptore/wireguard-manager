---
import { URL } from "node:url";
import LoginLayout from "@/layouts/LoginLayout.astro";

const reqUrl = new URL(Astro.request.url);
const errorSearchParam = reqUrl.searchParams.get("error");
---

<LoginLayout>
  <div class="flex min-h-screen items-center justify-center text-gray-100">
    <div
      class="flex w-5/6 md:w-2/3 lg:w-1/2 xl:w-1/3 shadow-2xl rounded-2xl flex-col border border-[#191e3a]"
    >
      <div class="flex-1 p-6">
        <form action="/auth/login" method="post">
          <div class="mb-6 last:mb-0">
            <label class="block font-bold mb-2" for="username">Username</label>
            <input
              id="username"
              name="username"
              autocomplete="email"
              class="px-3 py-2 max-w-full border-gray-700 rounded w-full dark:placeholder-gray-400 focus:ring focus:ring-blue-600 focus:border-blue-600 focus:outline-none h-12 border bg-gray-800"
              placeholder="john.doe"
            />
          </div>
          <div class="mb-6 last:mb-0">
            <label class="block font-bold mb-2" for="password">Password</label>
            <div>
              <div class="relative">
                <input
                  id="password"
                  name="password"
                  type="password"
                  autocomplete="current-password"
                  class="px-3 py-2 max-w-full border-gray-700 rounded w-full dark:placeholder-gray-400 focus:ring focus:ring-blue-600 focus:border-blue-600 focus:outline-none h-12 border bg-gray-800"
                  placeholder="**********"
                />
              </div>
            </div>
          </div>
          <hr class="my-6 -mx-6 dark:border-gray-800 border-t" />
          <div class="-mb-3 text-center">
            <button
              class="w-full focus:outline-none uppercase transition-colors focus:ring duration-150 border cursor-pointer rounded-lg border-violet-600 ring-violet-700 bg-violet-500 text-white hover:bg-violet-600 mb-3 py-2 px-3"
              type="submit"
            >
              <span class="px-2">Sign in</span>
            </button>
          </div>
        </form>
      </div>
    </div>
    {
      errorSearchParam !== null &&
        {
          "401": (
            <div
              id="error-banner"
              class="py-2 pl-4 fixed bottom-0 left-0 right-0 bg-yellow-600"
            >
              <i class="fa-solid fa-triangle-exclamation mr-1 align-baseline" />
              <span class="font-medium align-bottom">
                Please sign in again.
              </span>
            </div>
          ),
          "500": (
            <div
              id="error-banner"
              class="py-2 pl-4 fixed bottom-0 left-0 right-0 bg-red-600"
            >
              <i class="fa-solid fa-circle-exclamation mr-1 align-baseline" />
              <span class="font-medium align-bottom">
                Server error occurred. Try again, or call support if problem
                persists.
              </span>
            </div>
          ),
        }[errorSearchParam]
    }
  </div>
  <style>
    #error-banner {
      transition-property: bottom;
      transition-duration: 4s;
      transition-timing-function: linear;
    }
    #error-banner.goout {
      bottom: -100%;
    }
  </style>
  <script>
    setTimeout(() => {
      const errorBanner = document.getElementById("error-banner");
      if (errorBanner === null) {
        return;
      }

      const transitionDuration =
        window.getComputedStyle(errorBanner).transitionDuration;
      let transitionDurationMS = 0;
      if (transitionDuration.endsWith("ms")) {
        transitionDurationMS = parseFloat(transitionDuration.slice(0, -2));
      } else {
        transitionDurationMS = parseFloat(transitionDuration.slice(0, -1));
      }
      setTimeout(() => {
        errorBanner?.remove();
      }, transitionDurationMS + 500);
      errorBanner?.classList.toggle("goout");
    }, 3_000);
  </script>
</LoginLayout>
